{"ast":null,"code":"import { httpService } from \"./http.service\";\nimport { socketService, SOCKET_EMIT_NEWCHAT } from \"./socket.service\";\nexport const chatService = {\n  addChat,\n  getChatsByUser,\n  updateChat,\n  uploadImg\n};\nconst CLOUD_NAME = \"dbyslg0cu\";\nconst UPLOAD_URL = `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`;\nconst preset = \"rak3cbfo\";\n\nasync function addChat(chat, id) {\n  try {\n    const addedChat = await httpService.post(\"chat\", chat);\n    const {\n      users\n    } = addedChat;\n    const reciver = users[0]._id === id ? users[1] : users[0];\n    socketService.emit(SOCKET_EMIT_NEWCHAT, {\n      chat: addedChat,\n      reciver\n    });\n    delete addedChat.users;\n    addedChat.user = reciver;\n    return addedChat;\n  } catch (error) {\n    console.log(\"error while adding chat to user: \", error);\n  }\n}\n\nasync function getChatsByUser() {\n  try {\n    return await httpService.get(\"chat/user-chats\");\n  } catch (error) {\n    console.log(\"error while getting chats of user: \", error);\n  }\n}\n\nasync function updateChat(chat) {\n  try {\n    return await httpService.put(\"chat\", chat);\n  } catch (error) {\n    console.log(\"error while updating chat: \", error);\n  }\n}\n\nasync function uploadImg(formData) {\n  formData.append('file', ev.target.files[0]);\n  formData.append('upload_preset', 'd7eros5c');\n  return fetch(UPLOAD_URL, {\n    method: 'POST',\n    body: formData\n  }).then(res => res.json()).then(res => {\n    const elImg = document.createElement('img');\n    elImg.src = res.url;\n    document.body.append(elImg);\n  }).catch(err => console.error(err));\n}","map":{"version":3,"sources":["/Users/noamshirm/Dropbox/Mac/Desktop/PWA/chatMe/front-end/src/services/chat.service.js"],"names":["httpService","socketService","SOCKET_EMIT_NEWCHAT","chatService","addChat","getChatsByUser","updateChat","uploadImg","CLOUD_NAME","UPLOAD_URL","preset","chat","id","addedChat","post","users","reciver","_id","emit","user","error","console","log","get","put","formData","append","ev","target","files","fetch","method","body","then","res","json","elImg","document","createElement","src","url","catch","err"],"mappings":"AAAA,SAASA,WAAT,QAA4B,gBAA5B;AACA,SAASC,aAAT,EAAwBC,mBAAxB,QAAmD,kBAAnD;AAEA,OAAO,MAAMC,WAAW,GAAG;AACzBC,EAAAA,OADyB;AAEzBC,EAAAA,cAFyB;AAGzBC,EAAAA,UAHyB;AAIzBC,EAAAA;AAJyB,CAApB;AAOP,MAAMC,UAAU,GAAG,WAAnB;AACA,MAAMC,UAAU,GAAI,mCAAkCD,UAAW,eAAjE;AACA,MAAME,MAAM,GAAG,UAAf;;AAEA,eAAeN,OAAf,CAAuBO,IAAvB,EAA6BC,EAA7B,EAAiC;AAC/B,MAAI;AACF,UAAMC,SAAS,GAAG,MAAMb,WAAW,CAACc,IAAZ,CAAiB,MAAjB,EAAyBH,IAAzB,CAAxB;AACA,UAAM;AAAEI,MAAAA;AAAF,QAAYF,SAAlB;AACA,UAAMG,OAAO,GAAGD,KAAK,CAAC,CAAD,CAAL,CAASE,GAAT,KAAiBL,EAAjB,GAAsBG,KAAK,CAAC,CAAD,CAA3B,GAAiCA,KAAK,CAAC,CAAD,CAAtD;AACAd,IAAAA,aAAa,CAACiB,IAAd,CAAmBhB,mBAAnB,EAAwC;AAAES,MAAAA,IAAI,EAAEE,SAAR;AAAmBG,MAAAA;AAAnB,KAAxC;AACA,WAAOH,SAAS,CAACE,KAAjB;AACAF,IAAAA,SAAS,CAACM,IAAV,GAAiBH,OAAjB;AACA,WAAOH,SAAP;AACD,GARD,CAQE,OAAOO,KAAP,EAAc;AACdC,IAAAA,OAAO,CAACC,GAAR,CAAY,mCAAZ,EAAiDF,KAAjD;AACD;AACF;;AAED,eAAef,cAAf,GAAgC;AAC9B,MAAI;AACF,WAAO,MAAML,WAAW,CAACuB,GAAZ,CAAgB,iBAAhB,CAAb;AACD,GAFD,CAEE,OAAOH,KAAP,EAAc;AACdC,IAAAA,OAAO,CAACC,GAAR,CAAY,qCAAZ,EAAmDF,KAAnD;AACD;AACF;;AAED,eAAed,UAAf,CAA0BK,IAA1B,EAAgC;AAC9B,MAAI;AACF,WAAO,MAAMX,WAAW,CAACwB,GAAZ,CAAgB,MAAhB,EAAwBb,IAAxB,CAAb;AACD,GAFD,CAEE,OAAOS,KAAP,EAAc;AACdC,IAAAA,OAAO,CAACC,GAAR,CAAY,6BAAZ,EAA2CF,KAA3C;AACD;AACF;;AAED,eAAeb,SAAf,CAAyBkB,QAAzB,EAAmC;AACjCA,EAAAA,QAAQ,CAACC,MAAT,CAAgB,MAAhB,EAAwBC,EAAE,CAACC,MAAH,CAAUC,KAAV,CAAgB,CAAhB,CAAxB;AACAJ,EAAAA,QAAQ,CAACC,MAAT,CAAgB,eAAhB,EAAiC,UAAjC;AAEA,SAAOI,KAAK,CAACrB,UAAD,EAAa;AACrBsB,IAAAA,MAAM,EAAE,MADa;AAErBC,IAAAA,IAAI,EAAEP;AAFe,GAAb,CAAL,CAIFQ,IAJE,CAIGC,GAAG,IAAIA,GAAG,CAACC,IAAJ,EAJV,EAKFF,IALE,CAKGC,GAAG,IAAI;AACT,UAAME,KAAK,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAd;AACAF,IAAAA,KAAK,CAACG,GAAN,GAAYL,GAAG,CAACM,GAAhB;AACAH,IAAAA,QAAQ,CAACL,IAAT,CAAcN,MAAd,CAAqBU,KAArB;AACH,GATE,EAUFK,KAVE,CAUIC,GAAG,IAAIrB,OAAO,CAACD,KAAR,CAAcsB,GAAd,CAVX,CAAP;AAWD","sourcesContent":["import { httpService } from \"./http.service\";\nimport { socketService, SOCKET_EMIT_NEWCHAT } from \"./socket.service\";\n\nexport const chatService = {\n  addChat,\n  getChatsByUser,\n  updateChat,\n  uploadImg,\n};\n\nconst CLOUD_NAME = \"dbyslg0cu\";\nconst UPLOAD_URL = `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`;\nconst preset = \"rak3cbfo\";\n\nasync function addChat(chat, id) {\n  try {\n    const addedChat = await httpService.post(\"chat\", chat);\n    const { users } = addedChat;\n    const reciver = users[0]._id === id ? users[1] : users[0];\n    socketService.emit(SOCKET_EMIT_NEWCHAT, { chat: addedChat, reciver });\n    delete addedChat.users;\n    addedChat.user = reciver;\n    return addedChat;\n  } catch (error) {\n    console.log(\"error while adding chat to user: \", error);\n  }\n}\n\nasync function getChatsByUser() {\n  try {\n    return await httpService.get(\"chat/user-chats\");\n  } catch (error) {\n    console.log(\"error while getting chats of user: \", error);\n  }\n}\n\nasync function updateChat(chat) {\n  try {\n    return await httpService.put(\"chat\", chat);\n  } catch (error) {\n    console.log(\"error while updating chat: \", error);\n  }\n}\n\nasync function uploadImg(formData) {\n  formData.append('file', ev.target.files[0])\n  formData.append('upload_preset', 'd7eros5c');\n\n  return fetch(UPLOAD_URL, {\n      method: 'POST',\n      body: formData\n  })\n      .then(res => res.json())\n      .then(res => {\n          const elImg = document.createElement('img');\n          elImg.src = res.url;\n          document.body.append(elImg);\n      })\n      .catch(err => console.error(err))\n}\n"]},"metadata":{},"sourceType":"module"}